{# templates/_2fa_setup_modal.html #}
{# Modal for setting up 2FA - triggered from settings accordion #}

<div id="setup2faModal" class="modal hidden">
    <div class="modal-content max-w-2xl">
        <span class="close-button" onclick="closeModal('setup2faModal')">&times;</span>
        <h2 class="text-2xl font-bold mb-4 primary-text">Set Up Two-Factor Authentication</h2>
        
        <!-- Step 1: Password Verification -->
        <div id="setup2fa-step1" class="space-y-4">
            <div class="bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-4">
                <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Why Enable 2FA?</h3>
                <p class="text-sm text-blue-700 dark:text-blue-300 mb-2">
                    Two-factor authentication adds an extra layer of security to your account. Even if someone knows your password, 
                    they won't be able to access your account without also having access to your authenticator app.
                </p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 mb-4">
                <h3 class="font-semibold primary-text mb-2">What You'll Need</h3>
                <ul class="text-sm secondary-text space-y-1">
                    <li>• An authenticator app (Google Authenticator, Microsoft Authenticator, or Authy)</li>
                    <li>• Your current account password</li>
                </ul>
            </div>
            
            <div>
                <label for="setup2fa-password" class="block text-sm font-medium mb-2 primary-text">Current Password</label>
                <input type="password" 
                       id="setup2fa-password" 
                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                       placeholder="Enter your current password">
            </div>
            
            <div id="setup2fa-step1-error" class="hidden p-3 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded-md text-sm"></div>
            
            <div class="flex justify-end gap-2">
                <button type="button" onclick="closeModal('setup2faModal')" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg">
                    Cancel
                </button>
                <button type="button" onclick="start2FASetup()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">
                    Continue
                </button>
            </div>
        </div>
        
        <!-- Step 2: QR Code & Verification -->
        <div id="setup2fa-step2" class="hidden space-y-4">
            <div class="text-center mb-4">
                <h3 class="text-lg font-semibold primary-text mb-4">Scan this QR Code</h3>
                <div id="setup2fa-qr-container" class="inline-block bg-white p-4 rounded border border-gray-300">
                    <!-- QR code will be inserted here -->
                </div>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                <p class="text-sm font-medium primary-text mb-2">Can't scan? Enter this code manually:</p>
                <div class="bg-white dark:bg-gray-800 p-3 rounded text-center">
                    <code id="setup2fa-secret" class="text-lg font-mono select-all"></code>
                </div>
            </div>
            
            <div>
                <label for="setup2fa-otp" class="block text-sm font-medium mb-2 primary-text">
                    Enter the 6-digit code from your app:
                </label>
                <input type="text" 
                       id="setup2fa-otp"
                       inputmode="numeric"
                       pattern="[0-9]*"
                       maxlength="6"
                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input text-center text-2xl tracking-widest"
                       placeholder="000000">
            </div>
            
            <div id="setup2fa-step2-error" class="hidden p-3 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded-md text-sm"></div>
            
            <div class="flex justify-end gap-2">
                <button type="button" onclick="cancel2FASetup()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg">
                    Cancel
                </button>
                <button type="button" onclick="verify2FASetup()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">
                    Verify & Enable
                </button>
            </div>
        </div>
        
        <!-- Step 3: Backup Codes -->
        <div id="setup2fa-step3" class="hidden space-y-4">
            <div class="bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg p-4 mb-4">
                <h3 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-2 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    2FA Enabled Successfully!
                </h3>
                <p class="text-sm text-green-700 dark:text-green-300">
                    Your account is now protected with two-factor authentication.
                </p>
            </div>
            
            <div class="bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4">
                <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-2 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    Save Your Backup Codes
                </h3>
                <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-3">
                    Store these codes in a safe place. Each code can only be used once to access your account if you lose your device.
                </p>
                <div id="setup2fa-backup-codes" class="bg-white dark:bg-gray-800 p-4 rounded grid grid-cols-2 gap-2 mb-3">
                    <!-- Backup codes will be inserted here -->
                </div>
                <button type="button" onclick="download2FABackupCodes()" 
                        class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Download Backup Codes
                </button>
            </div>
            
            <div class="flex justify-end">
                <button type="button" onclick="finish2FASetup()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">
                    Done
                </button>
            </div>
        </div>
    </div>
</div>